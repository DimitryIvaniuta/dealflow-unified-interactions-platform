server:
  port: 8080

spring:
  application:
    name: dealflow-unified-interactions-platform

  datasource:
    url: jdbc:postgresql://localhost:5451/dealflow
    username: dealflow
    password: dealflow
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: UTC
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  security:
    oauth2:
      resourceserver:
        jwt:
          public-key-location: classpath:keys/jwt-public-key.pem
          # JWT verification is configured via PEM keys by default (see app.security.jwt.*).
          # If you want to delegate verification to an external IdP (Keycloak/Auth0/etc.),
          # you can set issuer-uri / jwk-set-uri here and remove/disable PEM config.
          # issuer-uri: https://idp.example.com/realms/dealflow

app:
  security:
    jwt:
      issuer: dealflow
      private-key: classpath:keys/jwt-private-key.pem
      public-key: classpath:keys/jwt-public-key.pem
      access-token-ttl-minutes: 30
      refresh-token-ttl-days: 30
    rate-limit:
      login:
        enabled: true
        capacity: 10
        refill-tokens: 10
        refill-period-seconds: 60
    password:
      policy:
        min-length: 12
        require-upper: true
        require-lower: true
        require-digit: true
        require-special: true
      reset:
        token-ttl-minutes: 30
        expose-token: true
    bootstrap:
      admin:
        enabled: false
        username: user-1
        email: user-1@example.com
        display-name: Demo User
        # Set via env var in dev/prod: APP_SECURITY_BOOTSTRAP_ADMIN_PASSWORD
        password: ${APP_SECURITY_BOOTSTRAP_ADMIN_PASSWORD:change-me-now}
        roles: [ADMIN]
  web:
    cors:
      allowed-origins:
        - "http://localhost:5173"
        - "http://localhost:3000"
      allow-credentials: false
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
logging:
  level:
    root: INFO
    org.flywaydb: DEBUG
    org.springframework.security: INFO
    org.springframework.web: INFO
    org.hibernate.SQL: ${LOG_SQL_LEVEL:WARN}
    com.github.dimitryivaniuta.dealflow: DEBUG
    org.springframework.graphql: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %-5level [%thread] %logger{36} - %msg%n"
